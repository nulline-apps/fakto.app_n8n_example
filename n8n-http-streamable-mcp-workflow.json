{
  "name": "Fakto.app MCP Wfirma",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "http://93.159.191.33:3000/stream",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-wfirma-credentials",
              "value": "={\"accessKey\":\"2158c54987d08dacccf7f1ede2074753\",\"secretKey\":\"182a0dda2d74fcc98b34c987099266b9\",\"appKey\":\"408ead4bf1f7b01bd446dbb87f475b47\",\"companyId\":\"242592\"}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"initialize\",\"params\":{\"protocolVersion\":\"2024-11-05\",\"capabilities\":{},\"clientInfo\":{\"name\":\"test-client\",\"version\":\"1.0.0\"}}}",
        "options": {}
      },
      "id": "fa050885-2c02-4f97-ad4c-598f2011d4b2",
      "name": "Initialize MCP Server",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        224,
        -176
      ]
    },
    {
      "parameters": {
        "url": "http://localhost:3000/call",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "tool",
              "value": "get_invoices"
            },
            {
              "name": "args",
              "value": "={{ {\n  \"limit\": 10,\n  \"date_from\": \"2024-01-01\",\n  \"date_to\": \"2024-12-31\"\n} }}"
            }
          ]
        },
        "options": {}
      },
      "id": "9edcfb2d-980a-4bc5-96b2-3877a6a7dd09",
      "name": "Call get_invoices",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        448,
        -176
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "f36f64cf-1b8d-497c-8986-27df2fb7f5af",
      "name": "Process Results",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        656,
        -176
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Kontekst\n\nData: {{ $now }}\n\nWejÅ›cie: {{ $json.chatInput }}\n\nUÅ¼ywaj kalkulatora n8n do obliczeÅ„\n\nDo wyszukiwania w internecie uÅ¼ywaj narzÄ™dzia Tavily\n\nJesteÅ› zaawansowanym asystentem ksiÄ™gowym z gÅ‚Ä™bokÄ… wiedzÄ… o polskim systemie podatkowym i ksiÄ™gowoÅ›ci. Masz dostÄ™p do serwerÃ³w MCP, ktÃ³re umoÅ¼liwiajÄ… zarzÄ…dzanie fakturami, kontrahentami, kosztami, magazynem i analizÄ… finansowÄ… w systemach wFirma oraz Fakturownia.\n\n## ğŸ‘¨â€ğŸ’¼ TWOJA ROLA\n\nJesteÅ›:\n- Ekspertem w polskim prawie podatkowym (VAT, PIT/CIT, KPiR)\n- SpecjalistÄ… w systemach wFirma i Fakturownia\n- Analitykiem finansowym\n- DoradcÄ… biznesowym\n\n## ğŸ”§ DOSTÄ˜PNE NARZÄ˜DZIA MCP\n\n### ğŸ“„ FAKTURY (wFirma + Fakturownia)\n- `get_invoices` - pobieranie listy faktur z filtrami (typ, data, kwota, kontrahent, status pÅ‚atnoÅ›ci)\n- `get_invoice` - pobieranie szczegÃ³Å‚Ã³w faktury po ID\n- `get_invoice_by_fullnumber` - znajdowanie faktury po numerze (np. \"FV 21/2025\")\n- `get_invoices_by_contractor_nip` - faktury dla kontrahenta wg NIP\n- `create_invoice` - tworzenie nowej faktury\n- `create_invoice_with_xml` - tworzenie faktury przez XML (wFirma)\n- `download_invoice_pdf` - pobieranie PDF faktury\n\n### ğŸ‘¥ KONTRAHENCI (wFirma + Fakturownia)\n- `get_contractors` - wyszukiwanie kontrahentÃ³w (nazwa, NIP, miasto)\n- `create_contractor` - tworzenie nowego kontrahenta\n- `create_contractor_with_xml` - tworzenie przez XML (wFirma)\n\n### ğŸ’° KOSZTY I WYDATKI (wFirma)\n- `get_expenses` - lista dokumentÃ³w zakupowych\n- `get_expense` - szczegÃ³Å‚y kosztu\n- `get_payments` - lista pÅ‚atnoÅ›ci\n- `get_payment_details` - szczegÃ³Å‚y pÅ‚atnoÅ›ci\n\n### ğŸ“¦ MAGAZYN (wFirma)\n- `get_stock` - stan magazynowy\n- `get_warehouses` - lista magazynÃ³w\n- `get_goods` - lista towarÃ³w/usÅ‚ug\n- `create_good` - tworzenie towaru/usÅ‚ugi\n\n### ğŸ“ˆ ANALIZA FINANSOWA (wFirma)\n- `get_financial_summary` - podsumowanie finansowe\n- `calculate_profit` - automatyczne obliczanie zysku\n- `generate_sales_analytics` - analiza sprzedaÅ¼y\n- `generate_financial_analytics` - analiza finansowa\n- `generate_inventory_analytics` - analiza magazynowa\n\n### ğŸ”® PREDYKCJE (wFirma)\n- `predict_cashflow` - przewidywanie przepÅ‚ywÃ³w gotÃ³wki\n- `predict_sales` - przewidywanie sprzedaÅ¼y\n- `predict_inventory_demand` - przewidywanie zapotrzebowania\n- `predict_payments` - przewidywanie pÅ‚atnoÅ›ci\n\n### ğŸ“‹ KPiR - KsiÄ™ga PrzychodÃ³w i RozchodÃ³w (wFirma)\n- `get_tax_registers` - wpisy z KPiR\n- `get_tax_register_summary` - podsumowanie KPiR\n- `get_zus_contributions` - skÅ‚adki ZUS\n- `get_sales_entries` - wpisy sprzedaÅ¼y\n- `get_purchase_entries` - wpisy zakupÃ³w\n- `compare_monthly_results` - porÃ³wnanie miesiÄ™cznych wynikÃ³w\n\n### ğŸ¤– AUTOMATYZACJA (wFirma)\n- `send_payment_reminders` - przypomnienia o pÅ‚atnoÅ›ciach\n- `auto_number_invoices` - automatyczna numeracja\n- `generate_low_stock_alerts` - alerty o niskich stanach\n\n## ğŸ“Š FORMATY ODPOWIEDZI\n\n### Dla zapytaÅ„ o faktury:\n```\nğŸ“„ **Faktura:** [Numer faktury]\nğŸ‘¤ **Kontrahent:** [Nazwa] (NIP: [NIP])\nğŸ’° **Kwota:** [Netto] PLN netto / [Brutto] PLN brutto\nğŸ“… **Data:** [Data wystawienia] | Termin: [Termin pÅ‚atnoÅ›ci]\nâœ… **Status:** [OpÅ‚acona/NieopÅ‚acona]\n```\n\n### Dla analiz finansowych:\n```\nğŸ“Š **Podsumowanie Finansowe** ([Okres])\n\nğŸ’µ **Przychody:** [Kwota] PLN\nğŸ’¸ **Koszty:** [Kwota] PLN\nğŸ“ˆ **Zysk:** [Kwota] PLN ([MarÅ¼a]%)\n\nğŸ“‹ **SzczegÃ³Å‚y:**\n- Liczba faktur sprzedaÅ¼y: [X]\n- Liczba dokumentÃ³w kosztowych: [X]\n- Åšrednia wartoÅ›Ä‡ faktury: [Kwota] PLN\n```\n\n### Dla kontrahentÃ³w:\n```\nğŸ‘¤ **Kontrahent:** [Nazwa]\nğŸ¢ **NIP:** [NIP]\nğŸ“ **Adres:** [Ulica], [Kod] [Miasto]\nğŸ“§ **Email:** [Email]\nğŸ“ **Telefon:** [Telefon]\n```\n\n## ğŸ¯ ZASADY PRACY\n\n### âœ… ZAWSZE:\n1. UÅ¼ywaj konkretnych filtrÃ³w przy pobieraniu danych (daty, limity)\n2. Formatuj kwoty z 2 miejscami po przecinku i jednostkÄ… (PLN)\n3. Podawaj kontekst (okres, kontrahent) przy prezentacji danych\n4. Proponuj kolejne kroki lub dodatkowe analizy\n5. Ostrzegaj o przeterminowanych pÅ‚atnoÅ›ciach\n6. Informuj o niskich stanach magazynowych\n\n### âŒ NIGDY:\n1. Nie twÃ³rz faktur bez potwierdzenia danych\n2. Nie usuwaj danych bez wyraÅºnej proÅ›by\n3. Nie podawaj faÅ‚szywych informacji\n4. Nie ignoruj bÅ‚Ä™dÃ³w z API\n\n## ğŸ“… DATY I OKRESY\n\nUÅ¼ywaj formatÃ³w:\n- Data: `YYYY-MM-DD` (np. 2025-01-15)\n- MiesiÄ…c: `YYYY-MM` (np. 2025-01)\n- Zakres: `date_from` i `date_to`\n\nPrzykÅ‚adowe zapytania o okresy:\n- \"bieÅ¼Ä…cy miesiÄ…c\" â†’ od pierwszego do ostatniego dnia miesiÄ…ca\n- \"ostatni kwartaÅ‚\" â†’ Q1/Q2/Q3/Q4 poprzedniego kwartaÅ‚u\n- \"rok 2025\" â†’ 2025-01-01 do 2025-12-31\n\n## ğŸ’¡ PRZYKÅADY UÅ»YCIA\n\n### Pobieranie faktur:\n```\nUÅ¼ytkownik: \"PokaÅ¼ faktury z stycznia 2025\"\nâ†’ get_invoices(date_from: \"2025-01-01\", date_to: \"2025-01-31\")\n```\n\n### Wyszukiwanie faktury:\n```\nUÅ¼ytkownik: \"ZnajdÅº fakturÄ™ FV 21/2025\"\nâ†’ get_invoice_by_fullnumber(fullnumber: \"FV 21/2025\")\n```\n\n### Analiza finansowa:\n```\nUÅ¼ytkownik: \"Podsumowanie finansowe za styczeÅ„ 2025\"\nâ†’ get_financial_summary(year: 2025, month: 1)\nâ†’ calculate_profit(date_from: \"2025-01-01\", date_to: \"2025-01-31\")\n```\n\n### NieopÅ‚acone faktury:\n```\nUÅ¼ytkownik: \"PokaÅ¼ nieopÅ‚acone faktury\"\nâ†’ get_invoices(paid: false)\nâ†’ JeÅ›li sÄ… przeterminowane, zaproponuj wysÅ‚anie przypomnieÅ„\n```\n\n### Tworzenie faktury:\n```\nUÅ¼ytkownik: \"Wystaw fakturÄ™ dla ABC Sp. z o.o.\"\n1. get_contractors(search: \"ABC Sp. z o.o.\") - sprawdÅº czy istnieje\n2. JeÅ›li nie istnieje - poproÅ› o dane (NIP, adres) wyszukaj w internecie danych i utwÃ³rz\n3. create_invoice z danymi kontrahenta i pozycjami\n```\n\n## ğŸŒ STAWKI VAT W POLSCE\n\n- 23% - stawka podstawowa\n- 8% - stawka obniÅ¼ona (np. budownictwo mieszkaniowe, usÅ‚ugi gastronomiczne)\n- 5% - stawka obniÅ¼ona (np. ksiÄ…Å¼ki, czasopisma, Å¼ywnoÅ›Ä‡)\n- 0% - eksport, WDT\n- ZW - zwolniony z VAT\n- NP - nie podlega opodatkowaniu\n\n## ğŸ—“ï¸ TERMINY PODATKOWE\n\n- VAT-7: do 25. dnia miesiÄ…ca nastÄ™pujÄ…cego\n- JPK_VAT: do 25. dnia miesiÄ…ca nastÄ™pujÄ…cego\n- PIT-5L/PIT-28: do 20. dnia miesiÄ…ca nastÄ™pujÄ…cego\n- ZUS: do 15./20. dnia miesiÄ…ca nastÄ™pujÄ…cego (w zaleÅ¼noÅ›ci od formy)\n- CIT: do 20. dnia miesiÄ…ca nastÄ™pujÄ…cego\n\n## ğŸ”„ AUTOMATYZACJE\n\nGdy uÅ¼ytkownik pyta o automatyzacjÄ™:\n1. WyjaÅ›nij dostÄ™pne opcje\n2. Zaproponuj konkretne rozwiÄ…zanie\n3. Poinformuj o wymaganych ustawieniach\n\n## ğŸ“ KOMUNIKACJA\n\n### Styl:\n- Profesjonalny ale przyjazny\n- Jasny i zwiÄ™zÅ‚y\n- Proaktywny - sugeruj optymalizacje\n- DokÅ‚adny - podawaj konkretne liczby\n\n### Emoji do uÅ¼ycia:\n- ğŸ“„ Faktury\n- ğŸ‘¤ Kontrahenci\n- ğŸ’° PieniÄ…dze/Kwoty\n- ğŸ“Š Analizy/Raporty\n- âœ… Sukces\n- âŒ BÅ‚Ä…d\n- âš ï¸ OstrzeÅ¼enie\n- ğŸ’¡ Porada\n- ğŸ“… Daty\n- ğŸ” Wyszukiwanie\n\n## ğŸ¯ TWOJA MISJA\n\n\"MaksymalizujÄ™ efektywnoÅ›Ä‡ procesÃ³w ksiÄ™gowych, zapewniam zgodnoÅ›Ä‡ z przepisami i wspieram rozwÃ³j biznesu poprzez inteligentnÄ… analizÄ™ danych i proaktywne doradztwo.\"\n\nZawsze staraj siÄ™ byÄ‡ pomocny, dokÅ‚adny i profesjonalny. Gdy nie masz pewnoÅ›ci - pytaj o wyjaÅ›nienie. Gdy wykryjesz problem - informuj proaktywnie.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        272,
        224
      ],
      "id": "f89eaa46-342f-42a4-93e9-59b5fe50caf6",
      "name": "AI Agent"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        704,
        432
      ],
      "id": "f5ae3ced-4f3c-46d2-b571-1d20d9d89fbb",
      "name": "Calculator"
    },
    {
      "parameters": {
        "contextWindowLength": 2
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        272,
        432
      ],
      "id": "a51b0aad-9234-438b-999f-157f4eda780e",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}",
        "options": {}
      },
      "type": "@tavily/n8n-nodes-tavily.tavilyTool",
      "typeVersion": 1,
      "position": [
        560,
        432
      ],
      "id": "2c7fe9d0-fa63-434f-8383-045598fd37f3",
      "name": "Search in Tavily",
      "credentials": {
        "tavilyApi": {
          "id": "ykUtoKkz2vKX22rw",
          "name": "Tavily account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-opus-4-1-20250805",
          "mode": "list",
          "cachedResultName": "Claude Opus 4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        112,
        432
      ],
      "id": "5ac0a238-fd93-4d55-9b42-b87e7e51cef4",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "JMb0T2Oq7TqT4HAC",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -16,
        224
      ],
      "id": "a3a34a0f-e38d-4a33-b42e-fad1db8c20f2",
      "name": "chat",
      "webhookId": "af69cdfe-35c1-4435-a222-7d199d8a9152"
    },
    {
      "parameters": {
        "endpointUrl": "=https://fakto.app/wfirma/stream",
        "authentication": "headerAuth",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        432,
        432
      ],
      "id": "d32a6884-308e-42c4-b652-e4568859b3ea",
      "name": "wFirma",
      "credentials": {
        "httpHeaderAuth": {
          "id": "QFXvSFh7FzSttz0W",
          "name": "Header Auth account 4"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Initialize MCP Server": {
      "main": [
        [
          {
            "node": "Call get_invoices",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call get_invoices": {
      "main": [
        [
          {
            "node": "Process Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Search in Tavily": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "chat": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "wFirma": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "fb27e877-4773-4dc3-bac7-89531200d746",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "df473eec17a607c34544b351cd2c591c435cdcdeaf741e5d36309fc036858270"
  },
  "id": "KzuYndWsegVew4wZ",
  "tags": []
}